---
import BaseLayout from "../layouts/BaseLayout.astro";
import RouteMap from "../components/RouteMap.astro";

const pageTitle = "Recorrido La Doble Bragado 2025 - 500km de Épica Ciclística";
const pageDescription = "Descubre el recorrido completo de La Doble Bragado: 500km en 2 etapas desde Bragado hasta Chivilcoy. Mapas interactivos, perfil de elevación y datos técnicos de la clásica del oeste bonaerense.";
const pageKeywords = "recorrido doble bragado, mapa ciclismo argentina, 500km bragado chivilcoy, etapas ciclismo, perfil elevacion";

const structuredData = [
  {
    "@context": "https://schema.org",
    "@type": "SportsEvent",
    "name": "La Doble Bragado 2025",
    "startDate": "2025-11-21T06:00:00-03:00",
    "location": {
      "@type": "Place",
      "name": "Bragado a Chivilcoy",
      "address": "Buenos Aires, Argentina"
    },
    "offers": {
      "@type": "Offer",
      "description": "500km en 2 etapas - Inscripciones abiertas"
    }
  }
];
---

<BaseLayout
  title={pageTitle}
  description={pageDescription}
  keywords={pageKeywords}
  structuredData={structuredData}
>
  <a href="#contenido" class="sr-only focus:not-sr-only">Saltar al contenido</a>

  <main id="contenido" role="main" tabindex="-1">
    <!-- HERO (OK segun Cambios V5) -->
    <section id="hero-recorrido" class="h-screen flex items-center justify-center relative text-center" aria-labelledby="recorrido-title">
     <div class="absolute inset-0">
  <img src="/images/hero-cristina-greve-v5.jpg"
       alt="Pelotón femenino en La Doble Bragado"
       fetchpriority="high" decoding="async"
       class="absolute inset-0 w-full h-full object-cover" />
</div>

      <div class="absolute inset-0 bg-black/25" aria-hidden="true"></div>

      <div class="text-white z-10 max-w-5xl px-8">
        <h1 id="recorrido-title" class="font-display font-black text-6xl md:text-7xl lg:text-8xl mb-6 leading-tight text-amarillo">
          900 KM<br />DE ÉPICA
        </h1>
        <p class="text-xl md:text-3xl mb-8 opacity-90 font-semibold max-w-4xl mx-auto">
          El desafío más extremo del ciclismo argentino
        </p>
      </div>
    </section>

    <!-- DATOS DEL RECORRIDO (OK segun Cambios V5) -->
    <section class="bg-oscuro py-20" aria-labelledby="datos-title">
      <div class="max-w-7xl mx-auto px-8">
        <header class="text-center mb-12">
          <h2 id="datos-title" class="font-display font-black text-4xl md:text-5xl text-white uppercase">
            Datos del Recorrido
          </h2>
        </header>

        <!-- Masculina -->
        <div id="edicion-88-2025" role="group" aria-labelledby="ed-masc-title" class="mb-10 scroll-mt-24">
          <h3 id="ed-masc-title" class="text-center text-amarillo font-black text-xl md:text-2xl uppercase tracking-wide">
            EDICION 88 - 2025
          </h3>

          <div class="mt-6 grid md:grid-cols-2 lg:grid-cols-4 gap-8">
            <article class="bg-grisclaro/10 backdrop-blur-sm rounded-3xl p-8 text-center shadow-xl border-2 border-transparent hover:border-amarillo transition-all duration-300">
              <p class="text-5xl font-black text-amarillo leading-none">160</p>
              <h4 class="mt-3 text-2xl font-bold text-white uppercase">Corredores</h4>
            </article>
            <article class="bg-grisclaro/10 backdrop-blur-sm rounded-3xl p-8 text-center shadow-xl border-2 border-transparent hover:border-amarillo transition-all duration-300">
              <p class="text-5xl font-black text-amarillo leading-none">25</p>
              <h4 class="mt-3 text-2xl font-bold text-white uppercase">Equipos</h4>
            </article>
            <article class="bg-grisclaro/10 backdrop-blur-sm rounded-3xl p-8 text-center shadow-xl border-2 border-transparent hover:border-amarillo transition-all duration-300">
              <p class="text-5xl font-black text-amarillo leading-none">980k</p>
              <h4 class="mt-3 text-2xl font-bold text-white uppercase">KM Recorridos</h4>
            </article>
            <article class="bg-grisclaro/10 backdrop-blur-sm rounded-3xl p-8 text-center shadow-xl border-2 border-transparent hover:border-amarillo transition-all duration-300">
              <time datetime="PT27H56M43S" class="leading-none block">
                <span class="inline-flex items-baseline gap-3">
                  <span class="inline-flex items-baseline"><span class="text-4xl font-black text-amarillo">27</span><span class="text-xs font-bold text-white">h</span></span>
                  <span class="inline-flex items-baseline"><span class="text-4xl font-black text-amarillo">56</span><span class="text-xs font-bold text-white">m</span></span>
                  <span class="inline-flex items-baseline"><span class="text-4xl font-black text-amarillo">43</span><span class="text-xs font-bold text-white">s</span></span>
                </span>
              </time>
              <h4 class="mt-3 text-2xl font-bold text-white uppercase">Tiempo Total</h4>
            </article>
          </div>
        </div>

        <!-- Femenina -->
        <div id="edicion-2-2024" role="group" aria-labelledby="ed-fem-title" class="scroll-mt-24">
          <h3 id="ed-fem-title" class="text-center text-amarillo font-black text-xl md:text-2xl uppercase tracking-wide">
            EDICION 2 - 2024
          </h3>

          <div class="mt-6 grid md:grid-cols-2 lg:grid-cols-4 gap-8">
            <article class="bg-gradient-to-r from-celeste to-rosa rounded-3xl p-8 text-center shadow-xl border-2 border-transparent hover:border-amarillo transition-all duration-300">
              <p class="text-5xl font-black text-amarillo leading-none">120</p>
              <h4 class="mt-3 text-2xl font-bold text-white uppercase">Corredoras</h4>
            </article>
            <article class="bg-gradient-to-r from-celeste to-rosa rounded-3xl p-8 text-center shadow-xl border-2 border-transparent hover:border-amarillo transition-all duration-300">
              <p class="text-5xl font-black text-amarillo leading-none">19</p>
              <h4 class="mt-3 text-2xl font-bold text-white uppercase">Equipos</h4>
            </article>
            <article class="bg-gradient-to-r from-celeste to-rosa rounded-3xl p-8 text-center text-center shadow-xl border-2 border-transparent hover:border-amarillo transition-all duration-300">
              <p class="text-5xl font-black text-amarillo leading-none">750k</p>
              <h4 class="mt-3 text-2xl font-bold text-white uppercase">KM Recorridos</h4>
            </article>
            <article class="bg-gradient-to-r from-celeste to-rosa rounded-3xl p-8 text-center shadow-xl border-2 border-transparent hover:border-amarillo transition-all duration-300">
              <time datetime="PT20H40M50S" class="leading-none block">
                <span class="inline-flex items-baseline gap-3">
                  <span class="inline-flex items-baseline"><span class="text-4xl font-black text-amarillo">20</span><span class="text-xs font-bold text-white">h</span></span>
                  <span class="inline-flex items-baseline"><span class="text-4xl font-black text-amarillo">40</span><span class="text-xs font-bold text-white">m</span></span>
                  <span class="inline-flex items-baseline"><span class="text-4xl font-black text-amarillo">50</span><span class="text-xs font-bold text-white">s</span></span>
                </span>
              </time>
              <h4 class="mt-3 text-2xl font-bold text-white uppercase">Tiempo Total</h4>
            </article>
          </div>
        </div>
      </div>
    </section>

    <!-- EXPLORÁ EL RECORRIDO -->
    <section class="section-recorrido py-20" aria-labelledby="contenido-title">
      <div class="max-w-7xl mx-auto px-8">
        <header class="text-center mb-12">
          <h2 id="contenido-title" class="font-display font-black text-5xl text-oscuro mb-4 uppercase">
            Explorá el Recorrido
          </h2>
        </header>

        <!-- Tabs -->
        <nav class="flex justify-center mb-8" role="tablist" aria-label="Contenido del recorrido">
          <button id="tab-etapas" class="tab-btn bg-celeste text-white px-6 py-3 rounded-l-2xl font-bold text-base md:text-lg hover:bg-amarillo hover:text-oscuro transition focus:outline-none focus:ring-2 focus:ring-amarillo"
                  data-tab="etapas" role="tab" aria-selected="true" aria-controls="panel-etapas">
            ETAPAS
          </button>
          <button id="tab-mapas" class="tab-btn bg-grisclaro text-oscuro px-6 py-3 font-bold text-base md:text-lg hover:bg-amarillo hover:text-oscuro transition focus:outline-none focus:ring-2 focus:ring-amarillo"
                  data-tab="mapas" role="tab" aria-selected="false" aria-controls="panel-mapas">
            MAPAS INTERACTIVOS
          </button>
          <button id="tab-ganadores" class="tab-btn bg-grisclaro text-oscuro px-6 py-3 rounded-r-2xl font-bold text-base md:text-lg hover:bg-amarillo hover:text-oscuro transition focus:outline-none focus:ring-2 focus:ring-amarillo"
                  data-tab="ganadores" role="tab" aria-selected="false" aria-controls="panel-ganadores">
            GANADORES
          </button>
        </nav>

        <!-- Toggle ediciones -->
        <div class="flex justify-center mb-10">
          <div class="bg-grisclaro rounded-3xl p-1" role="group" aria-label="Edición">
            <button class="edition-toggle bg-celeste text-white px-5 py-2 rounded-3xl font-semibold transition"
                    data-edition="masc" aria-pressed="true">
              Masculina
            </button>
            <button class="edition-toggle bg-transparent text-oscuro px-5 py-2 rounded-3xl font-semibold transition hover:bg-rosa hover:text-white"
                    data-edition="fem" aria-pressed="false">
              Femenina
            </button>
          </div>
        </div>

        <!-- ============ ETAPAS (MASC) ============ -->
        <div id="panel-etapas" class="tab-panel" data-panel="etapas" data-edition="masc" role="tabpanel" tabindex="0" aria-labelledby="tab-etapas">
          <div class="timeline-container overflow-x-auto pb-2">
            <div class="timeline-track flex gap-6 min-w-[600px] md:min-w-0 relative">
              <!-- Línea base -->
              <div class="hidden md:block absolute top-10 left-12 right-12 h-0.5 bg-celeste/20 -z-10"></div>

              {[{n:1, city:'Chivilcoy', km:'120k', icon:'place'},
                {n:2, city:'Pergamino', km:'160k', icon:'place'},
                {n:3, city:'CRI', km:'10k', icon:'timer'},
                {n:4, city:'Pergamino', km:'130k', icon:'place'},
                {n:5, city:'Bragado', km:'120k', icon:'place'}].map((st) => (
                <article class="timeline-stage flex-shrink-0 text-center" data-stage-open data-title={`Etapa ${st.n} – Masculina`} data-desc={`Detalles de la etapa ${st.n} (${st.city}).`}>
                  <div class="relative w-fit mx-auto">
                    <button class="group relative w-16 h-16 md:w-20 md:h-20 bg-celeste text-white rounded-full grid place-items-center shadow-lg mx-auto mb-3 focus:outline-none focus:ring-2 focus:ring-amarillo overflow-visible hover:scale-105 transition">
                      <span class="material-icons text-2xl" aria-hidden="true">{st.icon}</span>
                    </button>
                    <div class="stage-pop hidden absolute left-1/2 -translate-x-1/2 top-[90%] w-64 bg-white rounded-xl p-4 shadow-2xl border border-amarillo/30 text-left">
                      <h4 class="text-oscuro font-bold mb-1">Etapa {st.n} — {st.city}</h4>
                      <p class="text-gris text-sm">Recorrido total: {st.km}. Todos los tiempos y ganadores disponibles en "Ganadores".</p>
                    </div>
                  </div>
                  <h3 class="font-bold text-base text-oscuro mb-1">Etapa {st.n}</h3>
                  <p class="text-xs text-oscuro/80 font-semibold">{st.city}</p>
                  <p class="text-[11px] text-celeste font-extrabold mt-1">{st.km}</p>
                </article>
              ))}
            </div>
          </div>
        </div>

        <!-- ============ ETAPAS (FEM) ============ -->
        <div id="panel-etapas-fem" class="tab-panel hidden" data-panel="etapas" data-edition="fem" role="tabpanel" tabindex="0" aria-labelledby="tab-etapas">
          <div class="timeline-container overflow-x-auto pb-2">
            <div class="timeline-track flex gap-6 min-w-[600px] md:min-w-0 relative">
              <div class="hidden md:block absolute top-10 left-12 right-12 h-0.5 bg-violeta/30 -z-10"></div>
              {[{n:1, city:'Chivilcoy', km:'100k', icon:'place'},
                {n:2, city:'Pergamino', km:'120k', icon:'place'},
                {n:3, city:'CRI', km:'8k', icon:'timer'},
                {n:4, city:'Final', km:'110k', icon:'place'}].map((st) => (
                <article class="timeline-stage flex-shrink-0 text-center" data-stage-open data-title={`Etapa ${st.n} – Femenina`} data-desc={`Detalles de la etapa ${st.n} (${st.city}).`}>
                  <div class="relative w-fit mx-auto">
                    <button class="group relative w-16 h-16 md:w-20 md:h-20 bg-violeta text-white rounded-full grid place-items-center shadow-lg mx-auto mb-3 focus:outline-none focus:ring-2 focus:ring-amarillo overflow-visible hover:scale-105 transition">
                      <span class="material-icons text-2xl" aria-hidden="true">{st.icon}</span>
                    </button>
                    <div class="stage-pop hidden absolute left-1/2 -translate-x-1/2 top-[90%] w-64 bg-white rounded-xl p-4 shadow-2xl border border-amarillo/30 text-left">
                      <h4 class="text-oscuro font-bold mb-1">Etapa {st.n} — {st.city}</h4>
                      <p class="text-gris text-sm">Recorrido total: {st.km}. Todos los tiempos y ganadoras en "Ganadores".</p>
                    </div>
                  </div>
                  <h3 class="font-bold text-base text-oscuro mb-1">Etapa {st.n}</h3>
                  <p class="text-xs text-oscuro/80 font-semibold">{st.city}</p>
                  <p class="text-[11px] text-celeste font-extrabold mt-1">{st.km}</p>
                </article>
              ))}
            </div>
          </div>
        </div>

        <!-- ============ MAPAS (MASC) ============ -->
        <div id="panel-mapas" class="tab-panel hidden" data-panel="mapas" data-edition="masc" role="tabpanel" tabindex="0" aria-labelledby="tab-mapas">
          <div class="bg-white rounded-3xl p-6 shadow-xl">
            <RouteMap edition="masc" stageFilter={true} defaultStage="1" />
          </div>
        </div>

        <!-- ============ MAPAS (FEM) ============ -->
        <div id="panel-mapas-fem" class="tab-panel hidden" data-panel="mapas" data-edition="fem" role="tabpanel" tabindex="0" aria-labelledby="tab-mapas">
          <div class="bg-white rounded-3xl p-6 shadow-xl">
            <RouteMap edition="fem" stageFilter={true} defaultStage="1" />
          </div>
        </div>

        <!-- ============ GANADORES (MASC) ============ -->
        <div id="panel-ganadores" class="tab-panel hidden" data-panel="ganadores" data-edition="masc" role="tabpanel" tabindex="0" aria-labelledby="tab-ganadores">
          <!-- Selector centrado -->
          <div class="mb-6 flex justify-center">
            <label for="winners-filter-masc" class="sr-only">Ver podio</label>
            <select id="winners-filter-masc" class="winners-filter bg-white border-2 border-celeste rounded-xl px-4 py-3 text-oscuro font-semibold focus:outline-none focus:ring-2 focus:ring-amarillo">
              <option value="1">Podio Etapa 1</option>
              <option value="2">Podio Etapa 2</option>
              <option value="3">Podio Etapa 3</option>
              <option value="4">Podio Etapa 4</option>
              <option value="5">Podio Etapa 5</option>
              <option value="C" selected>Podio Final</option>
            </select>
          </div>

          <!-- Título dinámico de podio -->
          <h3 id="winners-stage-title-masc" class="text-2xl font-bold text-oscuro text-center mt-2 mb-8">PODIO FINAL (MASCULINA)</h3>

          <!-- Pirámide de remeras -->
          <div id="winners-pyramid-masc" class="grid place-items-center gap-8" data-sex="masc">
            <div class="relative text-center">
              <button class="winner-btn group relative grid place-items-center" data-role="general" data-sex="masc">
                <img src="/images/lider-general.svg" alt="Remera líder general" class="w-40 h-40 mx-auto drop-shadow-xl ring-2 ring-oscuro/10 rounded-md transition group-hover:scale-105" />
                <span class="sr-only">Abrir ficha: Líder General</span>
              </button>
              <div class="text-center mt-3">
                <h4 class="text-xl font-bold text-oscuro">Líder General</h4>
                <p class="text-sm text-oscuro/70">Equipo</p>
                <p class="text-celeste font-bold">Tiempo de carrera</p>
              </div>
            </div>

            <div class="grid grid-cols-3 gap-8">
              <div class="relative text-center">
                <button class="winner-btn group relative grid place-items-center" data-role="sub23" data-sex="masc">
                  <img src="/images/lider-sub23.svg" alt="Remera líder Sub 23" class="w-28 h-28 mx-auto drop-shadow-xl ring-2 ring-oscuro/10 rounded-md transition group-hover:scale-105" />
                  <span class="sr-only">Abrir ficha: Líder Sub 23</span>
                </button>
                <h5 class="mt-2 text-base font-bold text-oscuro">Líder Sub 23</h5>
                <p class="text-sm text-oscuro/60">Equipo</p>
                <p class="text-celeste font-bold text-sm">Tiempo de carrera</p>
              </div>

              <div class="relative text-center">
                <button class="winner-btn group relative grid place-items-center" data-role="regular" data-sex="masc">
                  <img src="/images/lider-regularidad.svg" alt="Remera líder Regularidad" class="w-28 h-28 mx-auto drop-shadow-xl ring-2 ring-oscuro/10 rounded-md transition group-hover:scale-105" />
                  <span class="sr-only">Abrir ficha: Líder Regular</span>
                </button>
                <h5 class="mt-2 text-base font-bold text-oscuro">Líder Regular</h5>
                <p class="text-sm text-oscuro/60">Equipo</p>
                <p class="text-celeste font-bold text-sm">Puntos</p>
              </div>

              <div class="relative text-center">
                <button class="winner-btn group relative grid place-items-center" data-role="sprint" data-sex="masc">
                  <img src="/images/lider-sprint.svg" alt="Remera líder Sprint" class="w-28 h-28 mx-auto drop-shadow-xl ring-2 ring-oscuro/10 rounded-md transition group-hover:scale-105" />
                  <span class="sr-only">Abrir ficha: Líder Sprint</span>
                </button>
                <h5 class="mt-2 text-base font-bold text-oscuro">Líder Sprint</h5>
                <p class="text-sm text-oscuro/60">Equipo</p>
                <p class="text-celeste font-bold text-sm">Puntos</p>
              </div>
            </div>
          </div>
        </div>

        <!-- ============ GANADORES (FEM) ============ -->
        <div id="panel-ganadores-fem" class="tab-panel hidden" data-panel="ganadores" data-edition="fem" role="tabpanel" tabindex="0" aria-labelledby="tab-ganadores">
          <div class="mb-6 flex justify-center">
            <label for="winners-filter-fem" class="sr-only">Ver podio</label>
            <select id="winners-filter-fem" class="winners-filter bg-white border-2 border-violeta rounded-xl px-4 py-3 text-oscuro font-semibold focus:outline-none focus:ring-2 focus:ring-amarillo">
              <option value="1">Podio Etapa 1</option>
              <option value="2">Podio Etapa 2</option>
              <option value="3">Podio Etapa 3</option>
              <option value="4">Podio Etapa 4</option>
              <option value="C" selected>Podio Final</option>
            </select>
          </div>

          <h3 id="winners-stage-title-fem" class="text-2xl font-bold text-oscuro text-center mt-2 mb-8">PODIO FINAL (FEMENINA)</h3>

          <div id="winners-pyramid-fem" class="grid place-items-center gap-8" data-sex="fem">
            <div class="relative text-center">
              <button class="winner-btn group relative grid place-items-center" data-role="general" data-sex="fem">
                <img src="/images/lider-general.svg" alt="Remera líder general" class="w-40 h-40 mx-auto drop-shadow-xl ring-2 ring-oscuro/10 rounded-md transition group-hover:scale-105" />
                <span class="sr-only">Abrir ficha: Líder General</span>
              </button>
              <div class="text-center mt-3">
                <h4 class="text-xl font-bold text-oscuro">Líder General</h4>
                <p class="text-sm text-oscuro/70">Equipo</p>
                <p class="text-celeste font-bold">Tiempo de carrera</p>
              </div>
            </div>

            <div class="grid grid-cols-3 gap-8">
              <div class="relative text-center">
                <button class="winner-btn group relative grid place-items-center" data-role="sub23" data-sex="fem">
                  <img src="/images/lider-sub23.svg" alt="Remera líder Sub 23" class="w-28 h-28 mx-auto drop-shadow-xl ring-2 ring-oscuro/10 rounded-md transition group-hover:scale-105" />
                  <span class="sr-only">Abrir ficha: Líder Sub 23</span>
                </button>
                <h5 class="mt-2 text-base font-bold text-oscuro">Líder Sub 23</h5>
                <p class="text-sm text-oscuro/60">Equipo</p>
                <p class="text-celeste font-bold text-sm">Tiempo de carrera</p>
              </div>

              <div class="relative text-center">
                <button class="winner-btn group relative grid place-items-center" data-role="regular" data-sex="fem">
                  <img src="/images/lider-regularidad.svg" alt="Remera líder Regularidad" class="w-28 h-28 mx-auto drop-shadow-xl ring-2 ring-oscuro/10 rounded-md transition group-hover:scale-105" />
                  <span class="sr-only">Abrir ficha: Líder Regular</span>
                </button>
                <h5 class="mt-2 text-base font-bold text-oscuro">Líder Regular</h5>
                <p class="text-sm text-oscuro/60">Equipo</p>
                <p class="text-celeste font-bold text-sm">Puntos</p>
              </div>

              <div class="relative text-center">
                <button class="winner-btn group relative grid place-items-center" data-role="sprint" data-sex="fem">
                  <img src="/images/lider-sprint.svg" alt="Remera líder Sprint" class="w-28 h-28 mx-auto drop-shadow-xl ring-2 ring-oscuro/10 rounded-md transition group-hover:scale-105" />
                  <span class="sr-only">Abrir ficha: Líder Sprint</span>
                </button>
                <h5 class="mt-2 text-base font-bold text-oscuro">Líder Sprint</h5>
                <p class="text-sm text-oscuro/60">Equipo</p>
                <p class="text-celeste font-bold text-sm">Puntos</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Podios por etapa (FEM) -->
        <div id="stages-podium-fem" class="hidden">
          {Array.from({length:4}).map((_,i) => (
            <div data-win-stage-fem={String(i+1)} class={i===0 ? "" : "hidden"}>
              <h3 class="text-2xl font-bold text-oscuro text-center mt-4 mb-6">PODIO ETAPA {i+1}</h3>
              <div class="grid md:grid-cols-3 gap-6 max-w-5xl mx-auto">
                {[2,1,3].map((pos)=> (
                  <article class="text-center">
                    <div class="bg-oscuro border-2 border-rosa rounded-2xl overflow-hidden shadow-md mb-3">
                      <img src="/images/hero-bg.jpg" alt={`Puesto ${pos} - foto de la corredora`} class="w-full h-40 object-cover" />
                    </div>
                    <h4 class="text-lg font-bold text-oscuro mb-1">Nombre Apellido</h4>
                    <p class="text-sm text-oscuro/60 mb-1">Equipo</p>
                    <p class="text-celeste font-bold">2h 45m 37s</p>
                  </article>
                ))}
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- REVIVÍ LAS ETAPAS -->
    <section class="relative overflow-hidden py-16 lg:py-24 bg-gradient-to-b from-grisclaro to-white" aria-labelledby="revivi-title">
      <div class="absolute inset-0 opacity-5" aria-hidden="true">
        <div class="absolute top-0 left-0 w-96 h-96 bg-celeste rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 right-0 w-96 h-96 bg-violeta rounded-full blur-3xl"></div>
      </div>
      <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 id="revivi-title" class="font-black text-4xl md:text-6xl text-oscuro mb-4 uppercase tracking-tight">
            Reviví las <span class="bg-gradient-to-r from-celeste to-violeta bg-clip-text text-transparent">Etapas</span>
          </h2>
          <p class="text-gris text-lg max-w-2xl mx-auto">Experiencia completa de cada etapa con análisis y momentos destacados</p>
        </div>

        <!-- Tabs Masculina/Femenina -->
        <div class="flex justify-center mb-12">
          <div class="inline-flex bg-white rounded-full shadow-lg p-1">
            <button id="revivi-tab-masc" class="relative px-8 py-3 rounded-full font-semibold text-oscuro/80 transition-all duration-300">
              <span class="relative z-10">Masculina</span>
              <span class="revivi-indicator absolute inset-0 bg-gradient-to-r from-celeste to-celeste rounded-full opacity-0"></span>
            </button>
            <button id="revivi-tab-fem" class="relative px-8 py-3 rounded-full font-semibold text-oscuro/80 transition-all duration-300">
              <span class="relative z-10">Femenina</span>
              <span class="revivi-indicator absolute inset-0 bg-gradient-to-r from-violeta to-rosa rounded-full opacity-0"></span>
            </button>
          </div>
        </div>

 <!-- Player + Info -->
<div class="grid lg:grid-cols-3 gap-8 mb-12">
  <div class="lg:col-span-2">
    <div id="featured-video" class="relative group">
      <div class="relative aspect-video bg-oscuro rounded-2xl overflow-hidden shadow-2xl">
        <img id="featured-thumb" src="https://img.youtube.com/vi/_sI7tTt_PvM/maxresdefault.jpg" alt="Video destacado" class="w-full h-full object-cover" />
        <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent pointer-events-none"></div>

        <!-- RESTAURAR ESTE BOTÓN (overlay para abrir el modal) -->
        <button id="play-featured" class="absolute inset-0 grid place-items-center group/play">
          <span class="sr-only">Reproducir video</span>
        </button>

        <div class="absolute bottom-0 left-0 right-0 p-6 text-white">
          <div class="flex items-center gap-2 mb-2">
            <span class="px-3 py-1 bg-celeste/80 backdrop-blur rounded-full text-xs font-semibold">EN VIVO</span>
            <span id="featured-duration" class="text-sm opacity-80">15:42 min</span>
          </div>
          <h3 id="featured-title" class="text-2xl font-bold mb-1">Etapa 1 - Chivilcoy</h3>
          <p id="featured-desc" class="text-sm opacity-90">Sprint final emocionante con llegada al fotofinish</p>
        </div>
      </div>
      <div class="mt-4 bg-grisclaro rounded-full h-1 overflow-hidden">
        <div class="h-full bg-gradient-to-r from-celeste to-violeta w-0 transition-all duration-300" id="video-progress"></div>
      </div>
    </div>
  </div>

  <div class="lg:col-span-1">
    <div class="bg-white rounded-2xl shadow-xl p-6 h-full">
      <h3 class="font-bold text-oscuro text-lg mb-4 flex items-center gap-2">
        <span class="material-icons text-celeste">info</span>Información de Etapa
      </h3>
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div class="bg-grisclaro rounded-lg p-3">
            <p class="text-xs text-gris/80 mb-1">Distancia</p>
            <p class="font-bold text-oscuro" id="stage-distance">120 km</p>
          </div>
          <div class="bg-grisclaro rounded-lg p-3">
            <p class="text-xs text-gris/80 mb-1">Ganador</p>
            <p class="font-bold text-oscuro" id="stage-winner">J. Pérez</p>
          </div>
        </div>
        <div>
          <h4 class="font-semibold text-oscuro/90 mb-2 text-sm">Momentos Clave</h4>
          <ul class="space-y-2 text-sm text-gris">
            <li class="flex items-start gap-2"><span class="material-icons text-celeste text-base mt-0.5">sports_score</span><span>Sprint intermedio en km 45</span></li>
            <li class="flex items-start gap-2"><span class="material-icons text-violeta text-base mt-0.5">terrain</span><span>Puerto de montaña categoría 2</span></li>
            <li class="flex items-start gap-2"><span class="material-icons text-amarillo text-base mt-0.5">flag</span><span>Final con llegada masiva</span></li>
          </ul>
        </div>
        <!-- CTA eliminado -->
      </div>
    </div>
  </div>
</div>


        <!-- Carrusel -->
        <div class="relative">
          <button id="carousel-left" class="absolute -left-4 top-1/2 -translate-y-1/2 z-10 w-12 h-12 bg-white rounded-full shadow-lg grid place-items-center hover:scale-110 transition">
            <span class="material-icons text-oscuro">chevron_left</span>
          </button>
          <button id="carousel-right" class="absolute -right-4 top-1/2 -translate-y-1/2 z-10 w-12 h-12 bg-white rounded-full shadow-lg grid place-items-center hover:scale-110 transition">
            <span class="material-icons text-oscuro">chevron_right</span>
          </button>
          <div id="video-carousel" class="overflow-x-auto pb-4">
            <div id="carousel-track" class="flex gap-4 transition-transform duration-300"></div>
          </div>
        </div>

        <!-- Features -->
        <div class="mt-12 grid md:grid-cols-3 gap-6">
          <div class="bg-white rounded-xl p-6 text-center hover:-translate-y-1 transition shadow">
            <div class="w-16 h-16 bg-celeste/10 rounded-full grid place-items-center mx-auto mb-4"><span class="material-icons text-celeste text-2xl">analytics</span></div>
            <h3 class="font-bold text-oscuro mb-2">Análisis Técnico</h3>
            <p class="text-gris text-sm">Datos detallados de cada etapa con métricas avanzadas</p>
          </div>
          <div class="bg-white rounded-xl p-6 text-center hover:-translate-y-1 transition shadow">
            <div class="w-16 h-16 bg-rosa/10 rounded-full grid place-items-center mx-auto mb-4"><span class="material-icons text-rosa text-2xl">star</span></div>
            <h3 class="font-bold text-oscuro mb-2">Mejores Momentos</h3>
            <p class="text-gris text-sm">Compilación de las jugadas más emocionantes</p>
          </div>
          <div class="bg-white rounded-xl p-6 text-center hover:-translate-y-1 transition shadow">
            <div class="w-16 h-16 bg-amarillo/10 rounded-full grid place-items-center mx-auto mb-4"><span class="material-icons text-amarillo text-2xl">forum</span></div>
            <h3 class="font-bold text-oscuro mb-2">Entrevistas</h3>
            <p class="text-gris text-sm">Declaraciones exclusivas de los protagonistas</p>
          </div>
        </div>
      </div>

      <!-- Modal Video -->
      <div id="revivi-video-modal" class="hidden fixed inset-0 z-[1000] p-4 md:p-8">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>
        <div role="dialog" aria-modal="true" aria-labelledby="revivi-modal-title" class="relative bg-black rounded-2xl max-w-5xl w-full mx-auto shadow-2xl">
          <button id="revivi-video-close" class="absolute -top-4 -right-4 w-12 h-12 bg-white rounded-full grid place-items-center shadow-lg hover:scale-110 transition z-10" aria-label="Cerrar"><span class="material-icons text-oscuro">close</span></button>
          <div class="aspect-video"><iframe id="revivi-video-frame" src="" class="w-full h-full rounded-2xl" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
        </div>
      </div>
    </section>

    <!-- Modal Ganadores (fichas) -->
    <div id="winner-modal" class="hidden fixed inset-0 z-[1000] p-4 md:p-8">
      <div class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>
      <div role="dialog" aria-modal="true" aria-labelledby="winner-modal-title" class="relative bg-white rounded-2xl max-w-3xl w-full mx-auto shadow-2xl">
        <button id="winner-modal-close" class="absolute -top-4 -right-4 w-12 h-12 bg-white rounded-full grid place-items-center shadow-lg hover:scale-110 transition z-10" aria-label="Cerrar">
          <span class="material-icons text-oscuro">close</span>
        </button>

        <article class="grid md:grid-cols-[140px,1fr] gap-4 p-6">
          <img id="winner-photo" src="/images/placeholder-rider.jpg" alt="" class="w-32 h-32 md:w-36 md:h-36 object-cover rounded-xl ring-1 ring-grisclaro/60" />
          <div>
            <h3 id="winner-modal-title" class="text-oscuro font-bold text-2xl leading-tight">Nombre Apellido</h3>
            <p id="winner-team" class="text-sm text-oscuro/70 mt-1">Equipo</p>
            <p id="winner-time" class="text-celeste font-bold mt-2">Tiempo/Puntos</p>
            <hr class="my-4 border-grisclaro">
            <p id="winner-note" class="text-gris text-sm leading-relaxed">
              Crónica breve del desempeño del líder en esta etapa/clasificación: ataque en los últimos kilómetros, control del pelotón y remate en el sprint.
            </p>
          </div>
        </article>
      </div>
    </div>

    <!-- COUNTDOWN -->
    <section id="countdown" class="py-16 relative flex items-center justify-center" aria-labelledby="countdown-title">
      <img src="/images/img-countdown.jpg" alt="" loading="lazy" decoding="async" class="absolute inset-0 w-full h-full object-cover" />
      <div class="absolute inset-0 bg-black/40" aria-hidden="true"></div>
      <div class="max-w-7xl mx-auto px-6 relative z-10 text-center">
        <header class="mb-10">
          <h2 id="countdown-title" class="font-display font-black text-3xl md:text-5xl text-white mb-2 uppercase">Próximo evento</h2>
          <p class="text-base md:text-lg text-amarillo font-semibold"><time datetime="2025-11-21">21 de Noviembre 2025</time> - 3° edición femenina</p>
        </header>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 max-w-4xl mx-auto" role="timer" aria-label="Cuenta regresiva para La Doble Bragado 2025">
          <div class="bg-gradient-to-br from-violetaOscuro to-rosa p-6 sm:p-8 rounded-3xl text-center text-white"><span id="days" class="font-clock font-black text-4xl md:text-5xl block mb-1" aria-live="polite">--</span><span class="font-bold uppercase tracking-wider text-xs md:text-sm">Días</span></div>
          <div class="bg-gradient-to-br from-violetaOscuro to-rosa p-6 sm:p-8 rounded-3xl text-center text-white"><span id="hours" class="font-clock font-black text-4xl md:text-5xl block mb-1" aria-live="polite">--</span><span class="font-bold uppercase tracking-wider text-xs md:text-sm">Horas</span></div>
          <div class="bg-gradient-to-br from-violetaOscuro to-rosa p-6 sm:p-8 rounded-3xl text-center text-white"><span id="minutes" class="font-clock font-black text-4xl md:text-5xl block mb-1" aria-live="polite">--</span><span class="font-bold uppercase tracking-wider text-xs md:text-sm">Minutos</span></div>
          <div class="bg-gradient-to-br from-violetaOscuro to-rosa p-6 sm:p-8 rounded-3xl text-center text-white"><span id="seconds" class="font-clock font-black text-4xl md:text-5xl block mb-1" aria-live="polite">--</span><span class="font-bold uppercase tracking-wider text-xs md:text-sm">Segundos</span></div>
        </div>
      </div>
    </section>
  </main>
</BaseLayout>

<!-- COUNTDOWN IDEM INDEX.ASTRO -->
<script is:inline>
  function updateCountdown() {
    const targetDate = new Date("2025-11-21T00:00:00-03:00").getTime();
    const now = new Date().getTime();
    const difference = targetDate - now;

    const daysElement = document.getElementById("days");
    const hoursElement = document.getElementById("hours");
    const minutesElement = document.getElementById("minutes");
    const secondsElement = document.getElementById("seconds");

    if (difference > 0) {
      const days = Math.floor(difference / (1000 * 60 * 60 * 24));
      const hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((difference % (1000 * 60)) / 1000);

      if (daysElement) daysElement.textContent = String(days).padStart(2, "0");
      if (hoursElement) hoursElement.textContent = String(hours).padStart(2, "0");
      if (minutesElement) minutesElement.textContent = String(minutes).padStart(2, "0");
      if (secondsElement) secondsElement.textContent = String(seconds).padStart(2, "0");
    } else {
      if (daysElement) daysElement.textContent = "00";
      if (hoursElement) hoursElement.textContent = "00";
      if (minutesElement) minutesElement.textContent = "00";
      if (secondsElement) secondsElement.textContent = "00";
      clearInterval(countdownInterval);
    }
  }

  const countdownInterval = setInterval(updateCountdown, 1000);
  document.addEventListener("DOMContentLoaded", updateCountdown);
</script>

<script is:inline>
  // 1) Slideshow (respeta prefers-reduced-motion)
  (function () {
 
    const slides = document.querySelectorAll('#slide-1, #slide-2');
if (!slides.length) return;
...
// solo animar si hay 2+ slides
if (!reduce && slides.length > 1) {
  setInterval(() => {
    slides[current].style.opacity = '0';
    current = (current + 1) % slides.length;
    slides[current].style.opacity = '1';
  }, 5000);
}    let current = 0;
    const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    slides.forEach((s, i) => {
      s.style.transition = 'opacity
  })();

  // 2) Tabs + edición — muestra/oculta paneles y revalida Leaflet al entrar a "mapas"
  (function () {
    const btns = document.querySelectorAll('.tab-btn');
    const panels = document.querySelectorAll('.tab-panel');
    let currentEdition = 'masc';

    function invalidateRouteMapsSoon() {
      setTimeout(() => { window.__routeMaps?.invalidateAll?.(); }, 120);
    }

    function showPanel(name) {
      btns.forEach((b) => {
        const active = b.dataset.tab === name;
        b.setAttribute('aria-selected', String(active));
        b.classList.toggle('bg-celeste', active);
        b.classList.toggle('text-white', active);
        b.classList.toggle('bg-grisclaro', !active);
        b.classList.toggle('text-oscuro', !active);
      });

      let found = false;
      panels.forEach((p) => {
        const match = p.dataset.panel === name && p.dataset.edition === currentEdition;
        p.classList.toggle('hidden', !match);
        if (match) found = true;
      });

      if (!found) {
        currentEdition = 'masc';
        showPanel(name);
        return;
      }

      if (name === 'mapas') invalidateRouteMapsSoon();
    }

    btns.forEach((b) => b.addEventListener('click', () => showPanel(b.dataset.tab)));
    showPanel('etapas');

    // Toggle edición
    const edBtns = document.querySelectorAll('.edition-toggle');
    edBtns.forEach((b) => {
      b.addEventListener('click', () => {
        currentEdition = b.dataset.edition || 'masc';
        edBtns.forEach((x) => {
          const on = x === b;
          x.setAttribute('aria-pressed', String(on));
          x.classList.toggle('bg-celeste', on);
          x.classList.toggle('text-white', on);
          x.classList.toggle('bg-transparent', !on);
          x.classList.toggle('text-oscuro', !on);
        });
        const activeTab = (document.querySelector('.tab-btn[aria-selected="true"]') || btns[0])?.dataset.tab || 'etapas';
        showPanel(activeTab);
      });
    });
  })();

  // 3) Pop cards en timeline (Etapas)
  (function () {
    document.querySelectorAll('[data-stage-open]').forEach((card) => {
      const btn = card.querySelector('button');
      const pop = card.querySelector('.stage-pop');
      if (!btn || !pop) return;
      btn.addEventListener('click', (ev) => {
        ev.stopPropagation();
        document.querySelectorAll('.stage-pop').forEach((x) => x.classList.add('hidden'));
        pop.classList.toggle('hidden');
      });
    });
    document.addEventListener('click', () => {
      document.querySelectorAll('.stage-pop').forEach((x) => x.classList.add('hidden'));
    });
  })();

  // 4) GANADORES: pirámide + modal
  (function () {
    const winnersData = {
      masc: {
        C: {
          general: { name: 'N. Apellido', team: 'Equipo X', time: '7h 58m 33s', photo: '/images/placeholder-rider.jpg', note: 'Consistencia total a lo largo de la prueba y autoridad en los tramos clave.' },
          sub23:  { name: 'J. Joven',   team: 'Academia Y', time: '8h 10m 20s', photo: '/images/placeholder-rider.jpg', note: 'Proyección enorme: atacó en repechos y sostuvo el ritmo de los mayores.' },
          regular:{ name: 'R. Const',   team: 'Team Z',     time: '120 pts',      photo: '/images/placeholder-rider.jpg', note: 'Sumó puntos en sprints intermedios y finalizó en los puestos de vanguardia.' },
          sprint: { name: 'S. Velaz',   team: 'Velox',      time: '140 pts',      photo: '/images/placeholder-rider.jpg', note: 'Explosivo en las llegadas masivas, dominó el embalaje.' }
        },
        1: { 
          general: { name: 'Ganador E1', team: 'Equipo A', time: '2h 45m 37s', photo: '/images/placeholder-rider.jpg', note: 'Definición al sprint tras controlar las fugas.' },
          sub23:  { name: 'Sub23 E1',   team: 'Academia B', time: '—', photo: '/images/placeholder-rider.jpg', note: 'Gran lectura de carrera, siempre en el corte bueno.' },
          regular:{ name: 'Regular E1', team: 'Team C', time: '25 pts', photo: '/images/placeholder-rider.jpg', note: 'Acumuló puntos clave en metas volantes.' },
          sprint: { name: 'Sprint E1',  team: 'Team D', time: '40 pts', photo: '/images/placeholder-rider.jpg', note: 'Imbatible en el embalaje final.' }
        },
        2: { general:{name:'Ganador E2',team:'Equipo A',time:'3h 10m 02s',photo:'/images/placeholder-rider.jpg',note:'Escapada exitosa en terreno abierto.'}, sub23:{name:'Sub23 E2',team:'Academia B',time:'—',photo:'/images/placeholder-rider.jpg',note:'Solidez notable en el ritmo.'}, regular:{name:'Regular E2',team:'Team C',time:'22 pts',photo:'/images/placeholder-rider.jpg',note:'Puntos en todos los sprints.'}, sprint:{name:'Sprint E2',team:'Team D',time:'38 pts',photo:'/images/placeholder-rider.jpg',note:'Colocación perfecta y remate.'} },
        3: { general:{name:'Ganador CRI',team:'Equipo A',time:'11m 12s',photo:'/images/placeholder-rider.jpg',note:'Crono impecable, sin regalar un segundo.'}, sub23:{name:'Sub23 CRI',team:'Academia B',time:'—',photo:'/images/placeholder-rider.jpg',note:'Gran posición aerodinámica.'}, regular:{name:'Regular CRI',team:'Team C',time:'—',photo:'/images/placeholder-rider.jpg',note:'—'}, sprint:{name:'Sprint CRI',team:'Team D',time:'—',photo:'/images/placeholder-rider.jpg',note:'—'} },
        4: { general:{name:'Ganador E4',team:'Equipo A',time:'2h 59m 18s',photo:'/images/placeholder-rider.jpg',note:'Ataque en el puerto y victoria en solitario.'}, sub23:{name:'Sub23 E4',team:'Academia B',time:'—',photo:'/images/placeholder-rider.jpg',note:'Marcó el paso del grupo.'}, regular:{name:'Regular E4',team:'Team C',time:'24 pts',photo:'/images/placeholder-rider.jpg',note:'Regularidad en metas intermedias.'}, sprint:{name:'Sprint E4',team:'Team D',time:'35 pts',photo:'/images/placeholder-rider.jpg',note:'Gran punta de velocidad.'} },
        5: { general:{name:'Ganador E5',team:'Equipo A',time:'2h 41m 50s',photo:'/images/placeholder-rider.jpg',note:'Cierre a pura potencia en Bragado.'}, sub23:{name:'Sub23 E5',team:'Academia B',time:'—',photo:'/images/placeholder-rider.jpg',note:'Crece etapa a etapa.'}, regular:{name:'Regular E5',team:'Team C',time:'23 pts',photo:'/images/placeholder-rider.jpg',note:'Siempre en el lote delantero.'}, sprint:{name:'Sprint E5',team:'Team D',time:'42 pts',photo:'/images/placeholder-rider.jpg',note:'Definió con claridad el embalaje.'} }
      },
      fem: {
        C: {
          general: { name: 'N. Apellido', team: 'Equipo F', time: '7h 58m 33s', photo: '/images/placeholder-rider.jpg', note: 'Dominio táctico y cierre con temple en la general.' },
          sub23:  { name: 'J. Joven',   team: 'Academia F', time: '—', photo: '/images/placeholder-rider.jpg', note: 'Progresión constante, siempre adelante.' },
          regular:{ name: 'R. Const',   team: 'Team F',     time: '118 pts', photo: '/images/placeholder-rider.jpg', note: 'Sumó en casi todas las metas.' },
          sprint: { name: 'S. Velaz',   team: 'Velox F',    time: '133 pts', photo: '/images/placeholder-rider.jpg', note: 'Imparable en los metros finales.' }
        },
        1: { general:{name:'Ganadora E1',team:'Equipo A',time:'2h 55m 10s',photo:'/images/placeholder-rider.jpg',note:'Sprint limpio y potente.'}, sub23:{name:'Sub23 E1',team:'Academia B',time:'—',photo:'/images/placeholder-rider.jpg',note:'Muy sólida en el cierre.'}, regular:{name:'Regular E1',team:'Team C',time:'24 pts',photo:'/images/placeholder-rider.jpg',note:'Metas volantes aseguradas.'}, sprint:{name:'Sprint E1',team:'Team D',time:'39 pts',photo:'/images/placeholder-rider.jpg',note:'Remate fuerte y preciso.'} },
        2: { general:{name:'Ganadora E2',team:'Equipo A',time:'3h 05m 50s',photo:'/images/placeholder-rider.jpg',note:'Ataque sorpresa en el final.'}, sub23:{name:'Sub23 E2',team:'Academia B',time:'—',photo:'/images/placeholder-rider.jpg',note:'Gran lectura de carrera.'}, regular:{name:'Regular E2',team:'Team C',time:'21 pts',photo:'/images/placeholder-rider.jpg',note:'Sumó en los sprints intermedios.'}, sprint:{name:'Sprint E2',team:'Team D',time:'36 pts',photo:'/images/placeholder-rider.jpg',note:'Imbatible en el embalaje.'} },
        3: { general:{name:'Ganadora CRI',team:'Equipo A',time:'10m 50s',photo:'/images/placeholder-rider.jpg',note:'Crono técnica y precisa.'}, sub23:{name:'Sub23 CRI',team:'Academia B',time:'—',photo:'/images/placeholder-rider.jpg',note:'Manejo aerodinámico destacado.'}, regular:{name:'Regular CRI',team:'Team C',time:'—',photo:'/images/placeholder-rider.jpg',note:'—'}, sprint:{name:'Sprint CRI',team:'Team D',time:'—',photo:'/images/placeholder-rider.jpg',note:'—'} },
        4: { general:{name:'Ganadora E4',team:'Equipo A',time:'2h 49m 44s',photo:'/images/placeholder-rider.jpg',note:'Demostró jerarquía en la etapa reina.'}, sub23:{name:'Sub23 E4',team:'Academia B',time:'—',photo:'/images/placeholder-rider.jpg',note:'Gran temple en el final.'}, regular:{name:'Regular E4',team:'Team C',time:'23 pts',photo:'/images/placeholder-rider.jpg',note:'Regularidad asegurada.'}, sprint:{name:'Sprint E4',team:'Team D',time:'40 pts',photo:'/images/placeholder-rider.jpg',note:'Sprint ganador de punta a punta.'} }
      }
    };

    let currentStageM = 'C';
    let currentStageF = 'C';

    function updateWinnersTitle(sex, stage) {
      const el = document.getElementById(sex === 'masc' ? 'winners-stage-title-masc' : 'winners-stage-title-fem');
      if (!el) return;
      el.textContent = (stage === 'C' ? 'PODIO FINAL' : `PODIO ETAPA ${stage}`) + (sex === 'masc' ? ' (MASCULINA)' : ' (FEMENINA)');
    }

    function openWinnerModal(data, label) {
      const modal = document.getElementById('winner-modal');
      const photo = document.getElementById('winner-photo');
      const title = document.getElementById('winner-modal-title');
      const team = document.getElementById('winner-team');
      const time = document.getElementById('winner-time');
      const note = document.getElementById('winner-note');

      if (photo) photo.src = data.photo || '/images/placeholder-rider.jpg';
      if (title) title.textContent = `${label}: ${data.name || '—'}`;
      if (team) team.textContent = data.team || '—';
      if (time) time.textContent = data.time || '—';
      if (note) note.textContent = data.note || '';

      modal?.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    function closeWinnerModal() {
      const modal = document.getElementById('winner-modal');
      modal?.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }

    document.getElementById('winner-modal-close')?.addEventListener('click', closeWinnerModal);
    document.getElementById('winner-modal')?.addEventListener('click', (e) => { if (e.target.id === 'winner-modal') closeWinnerModal(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeWinnerModal(); });

    function wirePyramid(containerId, sex) {
      const container = document.getElementById(containerId);
      if (!container) return;
      container.querySelectorAll('.winner-btn').forEach((btn) => {
        btn.addEventListener('click', () => {
          const role = btn.getAttribute('data-role');
          const stage = sex === 'masc' ? currentStageM : currentStageF;
          const pack = winnersData[sex === 'masc' ? 'masc' : 'fem'][stage]?.[role] || {};
          const label =
            role === 'general' ? 'Líder General' :
            role === 'sub23'  ? 'Líder Sub 23'  :
            role === 'regular'? 'Líder Regular' : 'Líder Sprint';
          openWinnerModal(pack, label);
        });
      });
    }

    function wireSelect(selectId, sex) {
      const select = document.getElementById(selectId);
      if (!select) return;
      select.addEventListener('change', (e) => {
        const stage = e.target.value;
        if (sex === 'masc') currentStageM = stage; else currentStageF = stage;
        updateWinnersTitle(sex === 'masc' ? 'masc' : 'fem', stage);
      });
      const initStage = select.value || 'C';
      if (sex === 'masc') currentStageM = initStage; else currentStageF = initStage;
      updateWinnersTitle(sex === 'masc' ? 'masc' : 'fem', initStage);
    }

    wirePyramid('winners-pyramid-masc', 'masc');
    wirePyramid('winners-pyramid-fem', 'fem');
    wireSelect('winners-filter-masc', 'masc');
    wireSelect('winners-filter-fem', 'fem');
  })();

  // 5) REVIVÍ LAS ETAPAS
  (function () {
    const videoData = {
      masculina: [
        { id: '_sI7tTt_PvM', title: 'Etapa 1 - Chivilcoy', duration: '15:42', distance: '120 km', winner: 'J. Pérez', desc: 'Sprint final emocionante con llegada al fotofinish' },
        { id: 'dQw4w9WgXcQ', title: 'Etapa 2 - Pergamino', duration: '18:30', distance: '160 km', winner: 'M. González', desc: 'Escapada exitosa en los últimos 20km' },
        { id: '_sI7tTt_PvM', title: 'Etapa 3 - CRI',       duration: '12:15', distance: '10 km',  winner: 'L. Rodríguez', desc: 'Contrarreloj técnica con viento cruzado' },
        { id: 'dQw4w9WgXcQ', title: 'Etapa 4 - Pergamino', duration: '16:48', distance: '130 km', winner: 'A. Martínez',  desc: 'Victoria en solitario tras ataque en el puerto' },
        { id: '_sI7tTt_PvM', title: 'Etapa 5 - Bragado',   duration: '14:22', distance: '120 km', winner: 'D. Silva',     desc: 'Final apretado con tres corredores al sprint' }
      ],
      femenina: [
        { id: 'dQw4w9WgXcQ', title: 'Etapa 1 - Chivilcoy', duration: '13:20', distance: '100 km', winner: 'S. López',     desc: 'Dominio absoluto del equipo líder' },
        { id: '_sI7tTt_PvM', title: 'Etapa 2 - Pergamino', duration: '15:45', distance: '120 km', winner: 'C. Fernández', desc: 'Ataque sorpresa en el último kilómetro' },
        { id: 'dQw4w9WgXcQ', title: 'Etapa 3 - CRI',       duration: '10:30', distance: '8 km',   winner: 'V. Ruiz',      desc: 'Récord de velocidad media en contrarreloj' },
        { id: '_sI7tTt_PvM', title: 'Etapa 4 - Final',     duration: '14:15', distance: '110 km', winner: 'P. García',    desc: 'Victoria emotiva en la etapa reina' }
      ]
    };

    let currentCategory = 'masculina';
    let currentVideoIndex = 0;

    const mascTab = document.getElementById('revivi-tab-masc');
    const femTab = document.getElementById('revivi-tab-fem');

    function switchCategory(cat) {
      currentCategory = cat;
      currentVideoIndex = 0;
      const i1 = mascTab?.querySelector('.revivi-indicator');
      const i2 = femTab?.querySelector('.revivi-indicator');
      if (cat === 'masculina') {
        if (i1) i1.style.opacity = '1';
        if (i2) i2.style.opacity = '0';
        mascTab?.classList.add('text-white');
        femTab?.classList.remove('text-white');
      } else {
        if (i2) i2.style.opacity = '1';
        if (i1) i1.style.opacity = '0';
        femTab?.classList.add('text-white');
        mascTab?.classList.remove('text-white');
      }
      loadVideos();
      updateFeatured(0);
    }

    function loadVideos() {
      const track = document.getElementById('carousel-track');
      if (!track) return;
      const vids = videoData[currentCategory] || [];
      track.innerHTML = vids.map((v, idx) => `
        <div class="flex-shrink-0 w-72 cursor-pointer" data-vid="${idx}">
          <div class="relative group">
            <div class="aspect-video bg-oscuro rounded-lg overflow-hidden shadow-lg">
              <img src="https://img.youtube.com/vi/${v.id}/mqdefault.jpg" alt="${v.title}" class="w-full h-full object-cover"/>
              <div class="absolute inset-0 bg-black/40 group-hover:bg-black/20 transition"></div>
              <div class="absolute inset-0 grid place-items-center">
                <div class="w-12 h-12 bg-white/90 rounded-full grid place-items-center group-hover:scale-110 transition">
                  <span class="material-icons text-oscuro ml-1">play_arrow</span>
                </div>
              </div>
              <div class="absolute bottom-2 right-2 px-2 py-1 bg-black/70 rounded text-white text-xs">${v.duration}</div>
            </div>
            <h4 class="mt-2 font-semibold text-oscuro">${v.title}</h4>
            <p class="text-sm text-gris">${v.distance}</p>
          </div>
        </div>`).join('');

      track.querySelectorAll('[data-vid]').forEach((el) =>
        el.addEventListener('click', () => updateFeatured(+el.dataset.vid))
      );
    }

    function updateFeatured(index) {
      currentVideoIndex = index;
      const v = (videoData[currentCategory] || [])[index];
      if (!v) return;
      const thumb = document.getElementById('featured-thumb');
      const title = document.getElementById('featured-title');
      const desc = document.getElementById('featured-desc');
      const distance = document.getElementById('stage-distance');
      const winner = document.getElementById('stage-winner');
      const duration = document.getElementById('featured-duration');
      const progress = document.getElementById('video-progress');

      if (thumb) thumb.src = `https://img.youtube.com/vi/${v.id}/maxresdefault.jpg`;
      if (title) title.textContent = v.title;
      if (desc) desc.textContent = v.desc;
      if (distance) distance.textContent = v.distance;
      if (winner) winner.textContent = v.winner;
      if (duration) duration.textContent = v.duration + ' min';
      if (progress) {
        progress.style.width = '0%';
        setTimeout(() => { progress.style.width = '30%'; }, 100);
      }

      document.querySelectorAll('#carousel-track .aspect-video').forEach((el, i) => {
        el.classList.toggle('ring-4', i === index);
        el.classList.toggle('ring-celeste', i === index);
      });
    }

    function openModal(url) {
      const modal = document.getElementById('revivi-video-modal');
      const frame = document.getElementById('revivi-video-frame');
      if (!modal || !frame) return;
      frame.src = url;
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      const modal = document.getElementById('revivi-video-modal');
      const frame = document.getElementById('revivi-video-frame');
      if (!modal || !frame) return;
      frame.src = '';
      modal.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }

    document.getElementById('play-featured')?.addEventListener('click', () => {
      const v = (videoData[currentCategory] || [])[currentVideoIndex];
      if (!v) return;
      openModal(`https://www.youtube.com/embed/${v.id}?autoplay=1&rel=0`);
    });

    document.getElementById('revivi-video-close')?.addEventListener('click', closeModal);
    document.getElementById('revivi-video-modal')?.addEventListener('click', (e) => { if (e.target.id === 'revivi-video-modal') closeModal(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

    const track = document.getElementById('carousel-track');
    document.getElementById('carousel-left')?.addEventListener('click', () => { track?.scrollBy({ left: -320, behavior: 'smooth' }); });
    document.getElementById('carousel-right')?.addEventListener('click', () => { track?.scrollBy({ left: 320, behavior: 'smooth' }); });

    document.getElementById('revivi-tab-masc')?.addEventListener('click', () => switchCategory('masculina'));
    document.getElementById('revivi-tab-fem')?.addEventListener('click',  () => switchCategory('femenina'));

    switchCategory('masculina');
  })();
</script>
